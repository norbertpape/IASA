<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Norbert Pape</title>
    <link rel="stylesheet" href="styles/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="canonical" href="https://norbertpape.github.io/index.html" />
    <meta name="viewport" content="width =device-width, initial-scale=1.0">
    <meta name="description" content="Personal website of Norbert Pape">
    <meta name="keywords" content="Norbert Pape, dance, art, choreography, VR, performance, augmented reality, contemporary art, virtual reality, unity, quest, oculus, pedagogy, self-organisation" />
</head>
<body>
    <main>
        <script src="menu.js"></script>
    </main>

    <script async src="https://unpkg.com/es-module-shims@1.8.0/dist/es-module-shims.js"></script>

    <script type="importmap">
        {
          "imports": {
            "three": "https://unpkg.com/three@0.156.1/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.156.1/examples/jsm/"
          }
        }
    </script>

    <script type="module">

        import * as THREE from 'https://unpkg.com/three/build/three.module.js'
        import Stats from 'https://unpkg.com/three/examples/jsm/libs/stats.module.js'
        import { OrbitControls } from 'https://unpkg.com/three/examples/jsm/controls/OrbitControls.js';
        import { GLTFLoader } from 'https://unpkg.com/three/examples/jsm/loaders/GLTFLoader.js';
        import { GUI } from 'https://unpkg.com/three/examples/jsm/libs/lil-gui.module.min.js';
        import { DecalGeometry } from 'https://unpkg.com/three/examples/jsm/geometries/DecalGeometry.js';

        const container = document.getElementById('container');

        let renderer, scene, camera, stats;
        let mesh;
        let raycaster;
        //let line;

        const intersection = {
            intersects: false,
            point: new THREE.Vector3(),
            normal: new THREE.Vector3()
        };
        const mouse = new THREE.Vector2();
        const intersects = [];

        const textureLoader = new THREE.TextureLoader();
        //const decalDiffuse = textureLoader.load('textures/decal/decal-diffuse.png');
        //decalDiffuse.colorSpace = THREE.SRGBColorSpace;
        //const decalNormal = textureLoader.load('textures/decal/decal-normal.jpg');

        const decalMaterial = new THREE.MeshPhongMaterial({
            specular: 0x444444,
            //map: decalDiffuse,
            //normalMap: decalNormal,
            normalScale: new THREE.Vector2(1, 1),
            shininess: 30,
            transparent: true,
            depthTest: true,
            depthWrite: false,
            polygonOffset: true,
            polygonOffsetFactor: - 4,
            wireframe: false
        });

        const decals = [];
        let mouseHelper;
        const position = new THREE.Vector3();
        const orientation = new THREE.Euler();
        const size = new THREE.Vector3(10, 10, 10);

        //const params = {
        //    minScale: 10,
        //    maxScale: 20,
        //    rotate: true,
        //    clear: function () {

        //        removeDecals();

        //    }
        //};

        init();
        animate();

        function init() {

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);
            //container.appendChild(renderer.domElement);

            stats = new Stats();
            document.body.appendChild(stats.dom);
            //container.appendChild(stats.dom);

            scene = new THREE.Scene();

            camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 1, 1000);
            camera.position.z = 120;

            const controls = new OrbitControls(camera, renderer.domElement);
            controls.minDistance = 50;
            controls.maxDistance = 200;

            scene.add(new THREE.AmbientLight(0x666666));

            const light = new THREE.SpotLight(0xffffff, 4.5);
            light.position.set(0, 1500, 200);
            light.angle = Math.PI * 0.2;
            light.decay = 0;
            light.castShadow = true;
            light.shadow.camera.near = 200;
            light.shadow.camera.far = 2000;
            light.shadow.bias = - 0.000222;
            light.shadow.mapSize.width = 1024;
            light.shadow.mapSize.height = 1024;
            scene.add(light);

            const planeGeometry = new THREE.PlaneGeometry(2000, 2000);
            planeGeometry.rotateX(- Math.PI / 2);
            const planeMaterial = new THREE.ShadowMaterial({ color: 0x000000, opacity: 0.2 });

            const plane = new THREE.Mesh(planeGeometry, planeMaterial);
            plane.position.y = - 200;
            plane.receiveShadow = true;
            scene.add(plane);

            //const dirLight2 = new THREE.DirectionalLight(0xccccff, 3);
            //dirLight2.position.set(- 1, 0.75, - 0.5);
            //scene.add(dirLight2);

            

            loadLeePerrySmith();

            raycaster = new THREE.Raycaster();

            mouseHelper = new THREE.Mesh(new THREE.BoxGeometry(1, 1, 10), new THREE.MeshNormalMaterial());
            mouseHelper.visible = false;
            scene.add(mouseHelper);

            window.addEventListener('resize', onWindowResize);

            let moved = false;

            controls.addEventListener('change', function () {

                moved = true;

            });

            window.addEventListener('pointerdown', function () {

                moved = false;

            });


            window.addEventListener('pointermove', onPointerMove);

            function onPointerMove(event) {

                if (event.isPrimary) {

                    checkIntersection(event.clientX, event.clientY);

                }

            }

            function checkIntersection(x, y) {

                if (mesh === undefined) return;

                mouse.x = (x / window.innerWidth) * 2 - 1;
                mouse.y = - (y / window.innerHeight) * 2 + 1;

                raycaster.setFromCamera(mouse, camera);
                raycaster.intersectObject(mesh, false, intersects);

                if (intersects.length > 0) {

                    const p = intersects[0].point;
                    mouseHelper.position.copy(p);
                    intersection.point.copy(p);

                    const n = intersects[0].face.normal.clone();
                    n.transformDirection(mesh.matrixWorld);
                    n.multiplyScalar(10);
                    n.add(intersects[0].point);

                    intersection.normal.copy(intersects[0].face.normal);
                    mouseHelper.lookAt(n);

                    //const positions = line.geometry.attributes.position;
                    //positions.setXYZ(0, p.x, p.y, p.z);
                    //positions.setXYZ(1, n.x, n.y, n.z);
                    //positions.needsUpdate = true;

                    intersection.intersects = true;

                    intersects.length = 0;

                } else {

                    intersection.intersects = false;

                }

            }

            //const gui = new GUI();

            //gui.add(params, 'minScale', 1, 30);
            //gui.add(params, 'maxScale', 1, 30);
            //gui.add(params, 'rotate');
            ////gui.add(params, 'clear');
            //gui.open();

        }

        function loadLeePerrySmith() {

            const map = textureLoader.load('3D/models/lao/kirby.png');
            //map.colorSpace = THREE.SRGBColorSpace;
            //const specularMap = textureLoader.load('models/gltf/LeePerrySmith/Map-SPEC.jpg');
            //const normalMap = textureLoader.load('models/gltf/LeePerrySmith/Infinite-Level_02_Tangent_SmoothUV.jpg');

            const loader = new GLTFLoader();

            loader.load('3D/models/Canoe.glb', function (gltf) { //lao/kirby.glb

                mesh = gltf.scene.children[0];
                mesh.material = new THREE.MeshLambertMaterial({ color:  0xa0a0a0 });
                //new THREE.MeshPhongMaterial({
                //    specular: 0x111111,
                //    map: map,
                //    //specularMap: specularMap,
                //    //normalMap: normalMap,
                //    shininess: 25
                //});

                scene.add(mesh);
                mesh.scale.set(0.01, 0.01, 0.01);

            });

        }


        //function removeDecals() {

        //    decals.forEach(function (d) {

        //        scene.remove(d);

        //    });

        //    decals.length = 0;

        //}

        function onWindowResize() {

            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();

            renderer.setSize(window.innerWidth, window.innerHeight);

        }

        function animate() {

            requestAnimationFrame(animate);

            renderer.render(scene, camera);

            stats.update();

        }

    </script>

</body>
</html>

<!--<html>
<head>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
</head>
<body>
    <script type="text/javascript">
        AFRAME.registerComponent('drag-rotate-component', {
            schema: { speed: { default: 1 } },
            init: function () {
                this.ifMouseDown = false;
                this.x_cord = 0;
                this.y_cord = 0;
                document.addEventListener('mousedown', this.OnDocumentMouseDown.bind(this));
                document.addEventListener('mouseup', this.OnDocumentMouseUp.bind(this));
                document.addEventListener('mousemove', this.OnDocumentMouseMove.bind(this));
            },
            OnDocumentMouseDown: function (event) {
                this.ifMouseDown = true;
                this.x_cord = event.clientX;
                this.y_cord = event.clientY;
            },
            OnDocumentMouseUp: function () {
                this.ifMouseDown = false;
            },
            OnDocumentMouseMove: function (event) {
                if (this.ifMouseDown) {
                    var temp_x = event.clientX - this.x_cord;
                    var temp_y = event.clientY - this.y_cord;
                    if (Math.abs(temp_y) < Math.abs(temp_x)) {
                        this.el.object3D.rotateY(temp_x * this.data.speed / 1000);
                    }
                    else {
                        this.el.object3D.rotateX(temp_y * this.data.speed / 1000);
                    }
                    this.x_cord = event.clientX;
                    this.y_cord = event.clientY;
                }
            }
        });
    </script>
    <a-scene>
        <a-assets>
            <a-asset-item id="kirby" src="3D/models/lao/kirby.glb"></a-asset-item>
        </a-assets>
        <a-camera drag-rotate-component look-controls="enabled:false" position="0 -1 2" ></a-camera>-->
<!--<a-collada-model drag-rotate-component src="#kirby" position="0 1 -3" rotation="0 270 0"></a-model>-->
<!--<a-entity drag-rotate-component gltf-model="#kirby" position="0 0 0" rotation="0 270 0"></a-entity>
</body>
</html>-->
