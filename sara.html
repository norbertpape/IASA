<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Time Trace</title>

    <style>
        canvas {
            background: white;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%,-50%);
            width: 100%; /*80vmin;*/
            height: 100%;
        }
    </style>
</head>

<body>
    <!--<div id="container">
        <video autoplay="true" id="videoElement">
        </video>
    </div>-->
    <canvas id="myCanvas"></canvas>
    <script>

        var VIDEO = null;
        var SIZEX = 500;
        var SIZEY = 300;
        var CANVAS;
        var LASTFRAME;

        function main() {

            initializeCamera();
            
            CANVAS = initializeCanvas("myCanvas", SIZEX, SIZEY);

            var ctx = CANVAS.getContext("2d");

            setInterval(function(){
            drawScene(ctx);
            },1);  // once every 100 ms
        }


        function initializeCanvas(canvasName, width, height) {
            let canvas = document.getElementById(canvasName);
            canvas.width = width;
            canvas.height = height;
            return canvas;
        }

        function drawScene(ctx) {
            if (VIDEO != null) {
                var min = Math.min(VIDEO.videoWidth, VIDEO.videoHeight);
                var sx = (VIDEO.videoWidth - min) / 2;
                var sy = (VIDEO.videoHeight - min) / 2;
                ctx.drawImage(VIDEO, sx, sy, min, min,
                    0, 0, SIZEX, SIZEY);
                timeTrace(ctx);
            } 
            
        }

        function timeTrace(ctx) {
            var imgData = ctx.getImageData(0, 0, SIZEX, SIZEY);
            if (LASTFRAME == null) LASTFRAME = imgData.data.slice();
            var data = imgData.data;
            var colwidth = 1;
            for (var y = 0; y < SIZEY; y++) {
                for (var i = 1; i <= colwidth; i++) {
                    data[(y * SIZEX + SIZEX - i) * 4 + 0] = data[(y * SIZEX + SIZEX / 2 -i) * 4 + 0];
                    data[(y * SIZEX + SIZEX - i) * 4 + 1] = data[(y * SIZEX + SIZEX / 2 -i) * 4 + 1];
                    data[(y * SIZEX + SIZEX - i) * 4 + 2] = data[(y * SIZEX + SIZEX / 2 -i) * 4 + 2];
                }

            }

            for (var x = 0; x < SIZEX - colwidth; x += colwidth) {
                for (var y = 0; y < SIZEY; y++) {
                    for (var i = 0; i < colwidth; i++) {
                        data[(y * SIZEX + x + i) * 4 + 0] = LASTFRAME[((y) * SIZEX + x + colwidth + i) * 4 + 0];
                        data[(y * SIZEX + x + i) * 4 + 1] = LASTFRAME[((y) * SIZEX + x + colwidth + i) * 4 + 1];
                        data[(y * SIZEX + x + i) * 4 + 2] = LASTFRAME[((y) * SIZEX + x + colwidth + i) * 4 + 2];
                    }
                }
            }
            ctx.putImageData(imgData, 0, 0)
            LASTFRAME = imgData.data.slice();
        }


        function initializeCamera() {
            var promise = navigator.mediaDevices.getUserMedia({ video: true });
            promise.then(function (signal) {
                VIDEO = document.createElement("video");
                VIDEO.srcObject = signal;
                VIDEO.play();
                
            }).catch(function (err) {
                alert("Camera Error");
            });
        }

        main();
    </script>
</body>
</html>



<!--<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>I.A.S.A.</title>
    <link rel="stylesheet" href='styles/style.css'>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="canonical" href="https://spaceaffairs.github.io/index.html">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Official Website of the International Agency for Space Affairs">
    <meta name="keywords" content="dance, art, choreography, VR, performance, augmented reality, contemporary art, virtual reality, unity, quest, oculus, pedagogy, self-organisation, math, mathematics, spirituality, decolonial, anticolonial, queer">
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">
</head>
    <body>
        <main>
            <script src="menu.js"></script>
        </main>
        <script async src="https://unpkg.com/es-module-shims@1.8.0/dist/es-module-shims.js"></script>

        <script type="importmap">
            {
                "imports": {
                "three": "../three.module.js"
                }
            }
        </script>

        <div class="iasaLogo">
            <img class="iasa" src='images/IASA_logo_grau.svg'>
        </div>
        <script type="module">

            import * as THREE from 'three';

            const container = document.getElementById('container');

            let renderer, scene, camera, composer, renderScene, bloomPass, mesh;

            init();
            animate();

            function init() {

                renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });

                renderer.setPixelRatio(window.devicePixelRatio);
                renderer.setSize(window.innerWidth, window.innerHeight);
                document.body.appendChild(renderer.domElement);

                scene = new THREE.Scene();

                camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 1, 1000);
                camera.position.z = 30;


                const controls = THREE.OrbitControls(camera, renderer.domElement);
                controls.minDistance = 10;
                controls.maxDistance = 30;

                const loader = new THREE.PLYLoader();


                loader.load('3D/models/ply/Leafs07_clean_300K.ply', function (geometry) {

                    const material = new THREE.PointsMaterial({ size: 0.01, vertexColors: true });
                    mesh = new THREE.Points(geometry, material);

                    mesh.position.x = - 0.2;
                    mesh.position.y = - 0.52;
                    mesh.position.z = - 0.0;
                    mesh.scale.multiplyScalar(30);
                    mesh.castShadow = true;
                    mesh.receiveShadow = true;

                    scene.add(mesh);
                });





                window.addEventListener('resize', onWindowResize);

                let moved = false;

                controls.addEventListener('change', function () {

                    moved = true;

                });

                window.addEventListener('pointerdown', function () {

                    moved = false;

                });



            }


            function onWindowResize() {

                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();

                renderer.setSize(window.innerWidth, window.innerHeight);

            }


            function animate() {

                renderer.setAnimationLoop(render);



            }

            function render() {
                renderer.render(scene, camera);
                //var t = performance.now() * 0.000001;
                //mesh.rotateY( t );
            }

        </script>

    </body>
</html>-->
